{"ast":null,"code":"var _jsxFileName = \"D:\\\\identity-managment\\\\components\\\\modals\\\\Connect.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport { Button, Image, Loading, Modal, Row } from '@geist-ui/react';\nimport Router from 'next/router';\nimport { Magic } from 'magic-sdk';\nimport { OAuthExtension } from '@magic-ext/oauth';\nimport { useUser } from '../../lib/hooks';\nimport { ethers } from 'ethers';\n\nfunction Connect({\n  modal,\n  setModal,\n  connectUser,\n  userConnected\n}) {\n  const {\n    0: isRedirecting,\n    1: setIsRedirecting\n  } = useState(false);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n\n  const handler = () => setModal(true);\n\n  const closeHandler = event => {\n    setModal(false);\n    console.log('closed');\n  };\n\n  const {\n    0: magic,\n    1: setMagic\n  } = useState(null);\n  const {\n    0: disabled,\n    1: setDisabled\n  } = useState(false);\n  useEffect(() => {\n    !magic && setMagic(new Magic(process.env.NEXT_PUBLIC_MAGIC_PUBLISHABLE_KEY, {\n      extensions: [new OAuthExtension()]\n    }));\n    magic === null || magic === void 0 ? void 0 : magic.preload();\n  }, [magic]);\n\n  async function handleLoginWithEmail(email) {\n    try {\n      setDisabled(true); // disable login button to prevent multiple emails from being triggered\n\n      let didToken = await magic.auth.loginWithMagicLink({\n        email,\n        redirectURI: `${process.env.NEXT_PUBLIC_CLIENT_URL}/callback`\n      });\n      authenticateWithServer(didToken);\n    } catch (error) {\n      setDisabled(false); // re-enable login button - user may have requested to edit their email\n\n      console.log(error);\n    }\n  }\n\n  async function handleLoginWithSocial(provider) {\n    await magic.oauth.loginWithRedirect({\n      provider,\n      redirectURI: `${process.env.NEXT_PUBLIC_CLIENT_URL}/callback`\n    });\n  } // try to login with webauthn, if that fails, revert to registering with webauthn\n\n\n  async function authenticateWithServer(didToken) {\n    const res = await fetch(`${process.env.NEXT_PUBLIC_MIDDLEWARE_URL}/api/login`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        Authorization: 'Bearer ' + didToken\n      }\n    });\n    res.status === 200 && Router.push('/');\n  }\n\n  return __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 7\n    }\n  }, __jsx(Modal, {\n    open: modal,\n    onClose: closeHandler,\n    disableBackdropClick: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 11\n    }\n  }, \"Login to Portex\"), __jsx(Modal.Content, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 11\n    }\n  }, __jsx(Row, {\n    gap: 0.8,\n    justify: \"center\",\n    style: {\n      marginBottom: '15px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    type: \"secondary\",\n    icon: __jsx(Image, {\n      width: \"25\",\n      height: \"25\",\n      src: \"/assets/metamask.png\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 19\n      }\n    }),\n    ghost: true,\n    onClick: () => {\n      connectUser(null), setModal(false), setLoading(true);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 15\n    }\n  }, \"MetaMask\")), __jsx(Row, {\n    gap: 0.8,\n    justify: \"center\",\n    style: {\n      marginBottom: '15px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    type: \"secondary\",\n    icon: __jsx(Image, {\n      width: \"25\",\n      height: \"25\",\n      src: \"/assets/github.png\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 23\n      }\n    }),\n    ghost: true,\n    onClick: () => {\n      handleLoginWithSocial('github');\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 15\n    }\n  }, \"GitHub\")), __jsx(Row, {\n    gap: 0.8,\n    justify: \"center\",\n    style: {\n      marginBottom: '15px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 13\n    }\n  }, __jsx(Button, {\n    type: \"secondary\",\n    icon: __jsx(Image, {\n      width: \"25\",\n      height: \"25\",\n      src: \"/assets/google.png\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 23\n      }\n    }),\n    ghost: true,\n    onClick: () => {\n      handleLoginWithSocial('google');\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 15\n    }\n  }, \"Google\"))), __jsx(Modal.Action, {\n    onClick: closeHandler,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 11\n    }\n  })), __jsx(Modal, {\n    open: loading && !userConnected,\n    disableBackdropClick: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  }, __jsx(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }\n  }, \"Login to Portex\"), __jsx(Modal.Content, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 11\n    }\n  }, __jsx(Row, {\n    style: {\n      padding: '10px 0'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }\n  }, __jsx(Loading, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 15\n    }\n  }, \"Connecting user \"))))));\n}\n\nexport default Connect;","map":{"version":3,"sources":["D:/identity-managment/components/modals/Connect.js"],"names":["React","useState","useEffect","Button","Image","Loading","Modal","Row","Router","Magic","OAuthExtension","useUser","ethers","Connect","modal","setModal","connectUser","userConnected","isRedirecting","setIsRedirecting","loading","setLoading","handler","closeHandler","event","console","log","magic","setMagic","disabled","setDisabled","process","env","NEXT_PUBLIC_MAGIC_PUBLISHABLE_KEY","extensions","preload","handleLoginWithEmail","email","didToken","auth","loginWithMagicLink","redirectURI","NEXT_PUBLIC_CLIENT_URL","authenticateWithServer","error","handleLoginWithSocial","provider","oauth","loginWithRedirect","res","fetch","NEXT_PUBLIC_MIDDLEWARE_URL","method","headers","Authorization","status","push","marginBottom","padding"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Button, Image, Loading, Modal, Row } from '@geist-ui/react';\r\nimport Router from 'next/router';\r\nimport { Magic } from 'magic-sdk';\r\nimport { OAuthExtension } from '@magic-ext/oauth';\r\nimport { useUser } from '../../lib/hooks';\r\nimport { ethers } from 'ethers';\r\n\r\nfunction Connect({ modal, setModal, connectUser, userConnected }) {\r\n  const [isRedirecting, setIsRedirecting] = useState(false);\r\n\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handler = () => setModal(true);\r\n  const closeHandler = (event) => {\r\n    setModal(false);\r\n    console.log('closed');\r\n  };\r\n\r\n  const [magic, setMagic] = useState(null);\r\n  const [disabled, setDisabled] = useState(false);\r\n\r\n  useEffect(() => {\r\n    !magic &&\r\n      setMagic(\r\n        new Magic(process.env.NEXT_PUBLIC_MAGIC_PUBLISHABLE_KEY, {\r\n          extensions: [new OAuthExtension()],\r\n        })\r\n      );\r\n    magic?.preload();\r\n  }, [magic]);\r\n\r\n  async function handleLoginWithEmail(email) {\r\n    try {\r\n      setDisabled(true); // disable login button to prevent multiple emails from being triggered\r\n      let didToken = await magic.auth.loginWithMagicLink({\r\n        email,\r\n        redirectURI: `${process.env.NEXT_PUBLIC_CLIENT_URL}/callback`,\r\n      });\r\n      authenticateWithServer(didToken);\r\n    } catch (error) {\r\n      setDisabled(false); // re-enable login button - user may have requested to edit their email\r\n      console.log(error);\r\n    }\r\n  }\r\n\r\n  async function handleLoginWithSocial(provider) {\r\n    await magic.oauth.loginWithRedirect({\r\n      provider,\r\n      redirectURI: `${process.env.NEXT_PUBLIC_CLIENT_URL}/callback`,\r\n    });\r\n  }\r\n\r\n  // try to login with webauthn, if that fails, revert to registering with webauthn\r\n  async function authenticateWithServer(didToken) {\r\n    const res = await fetch(\r\n      `${process.env.NEXT_PUBLIC_MIDDLEWARE_URL}/api/login`,\r\n      {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: 'Bearer ' + didToken,\r\n        },\r\n      }\r\n    );\r\n    res.status === 200 && Router.push('/');\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div>\r\n        {/* <Button auto onClick={handler}>\r\n          Show Modal\r\n        </Button> */}\r\n        <Modal open={modal} onClose={closeHandler} disableBackdropClick={true}>\r\n          <Modal.Title>Login to Portex</Modal.Title>\r\n\r\n          <Modal.Content>\r\n            <Row gap={0.8} justify='center' style={{ marginBottom: '15px' }}>\r\n              <Button\r\n                type='secondary'\r\n                icon={\r\n                  <Image width='25' height='25' src='/assets/metamask.png' />\r\n                }\r\n                ghost\r\n                onClick={() => {\r\n                  connectUser(null), setModal(false), setLoading(true);\r\n                }}\r\n              >\r\n                MetaMask\r\n              </Button>\r\n            </Row>\r\n            <Row gap={0.8} justify='center' style={{ marginBottom: '15px' }}>\r\n              <Button\r\n                type='secondary'\r\n                icon={<Image width='25' height='25' src='/assets/github.png' />}\r\n                ghost\r\n                onClick={() => {\r\n                  handleLoginWithSocial('github');\r\n                }}\r\n              >\r\n                GitHub\r\n              </Button>\r\n            </Row>\r\n            <Row gap={0.8} justify='center' style={{ marginBottom: '15px' }}>\r\n              <Button\r\n                type='secondary'\r\n                icon={<Image width='25' height='25' src='/assets/google.png' />}\r\n                ghost\r\n                onClick={() => {\r\n                  handleLoginWithSocial('google');\r\n                }}\r\n              >\r\n                Google\r\n              </Button>\r\n            </Row>\r\n          </Modal.Content>\r\n          <Modal.Action onClick={closeHandler} />\r\n        </Modal>\r\n        <Modal open={loading && !userConnected} disableBackdropClick>\r\n          <Modal.Title>Login to Portex</Modal.Title>\r\n\r\n          <Modal.Content>\r\n            <Row style={{ padding: '10px 0' }}>\r\n              <Loading>Connecting user </Loading>\r\n            </Row>\r\n          </Modal.Content>\r\n        </Modal>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Connect;\r\n"]},"metadata":{},"sourceType":"module"}